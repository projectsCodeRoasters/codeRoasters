#!/usr/bin/env sh

# Get the current branch name
branch="$(git rev-parse --abbrev-ref HEAD)"

# Check if we're in the middle of a merge
if [ -f .git/MERGE_HEAD ]; then
  # Allow merge commits on protected branches
  exit 0
fi

# Check if we're on master or release_Candidate branch
if [ "$branch" = "master" ] || [ "$branch" = "release_Candidate" ]; then
  echo "ðŸš« ERROR: Direct commits to $branch branch are not allowed!"
  echo "Please create a feature branch and submit a pull request."
  echo ""
  echo "To create a new branch, run:"
  echo "  git checkout -b feature/your-feature-name"
  exit 1
fi

# Check for console.log in staged files
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' > /dev/null; then
  if git diff --cached | grep -E '^\+[^+].*console\.log\(' > /dev/null; then
    echo "ðŸš« ERROR: console.log() statements are not allowed in commits!"
    echo ""
    echo "Found console.log in your staged changes."
    echo "Please remove all console.log statements before committing."
    echo ""
    echo "You can use console.warn() or console.error() instead if needed."
    exit 1
  fi
fi

npm run lint

